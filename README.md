# WooCommerce & OpenAI Title Refinement Automation

This script automates the process of refining product titles and descriptions in your WooCommerce store using OpenAI's GPT models.

## Features

- ‚úÖ Fetches all products from WooCommerce store
- ‚úÖ Refines each product title using OpenAI for better SEO
- ‚úÖ Auto-generates SEO-friendly slugs from refined titles
- ‚úÖ Optimizes og_description using AI for better SEO
- ‚úÖ Updates products with refined titles, slugs, and descriptions
- ‚úÖ Dry-run mode for testing
- ‚úÖ **Checkpoint system** to prevent duplicate processing
- ‚úÖ **Detailed logging** of all updates with timestamps
- ‚úÖ Comprehensive error handling with retries
- ‚úÖ Progress tracking and summary statistics

## Setup

### 1. Install Dependencies

```bash
pip install -r requirements.txt
```

### 2. Configure API Credentials

Create a `.env` file in the root directory (see `.env.example`):

```env
# WooCommerce API Authentication
# Base64 encoded string of consumer_key:consumer_secret
WOOCOMMERCE_AUTH=your_base64_encoded_auth_string

# OpenAI API Key
OPENAI_API_KEY=sk-your-openai-api-key-here
```

**To generate WooCommerce Base64 auth string:**
1. Go to WooCommerce ‚Üí Settings ‚Üí Advanced ‚Üí REST API
2. Create a key with "Read/Write" permissions
3. Encode `consumer_key:consumer_secret` in Base64:
   ```python
   import base64
   auth = base64.b64encode(b"ck_xxx:cs_xxx").decode()
   print(auth)
   ```

**To get OpenAI API key:**
1. Go to https://platform.openai.com/api-keys
2. Create a new API key
3. Copy and paste it into your `.env` file

### 3. Customize the SEO Prompts (Optional)

Edit the prompts in `OpenAIAPI.refine_title()` and `OpenAIAPI.refine_description()` methods to customize how content is refined.

## Usage

### Test Mode (Dry Run)

By default, the script runs in dry-run mode which shows what would happen without making actual changes:

```bash
cd script
python main.py
```

### Production Mode

To actually update products, modify the `main()` function:

```python
automation.run(
    dry_run=False,  # Set to False to make actual updates
    limit=None      # Set to None to process all products
)
```

### Processing Options

- `dry_run=True` - Test without updating products
- `dry_run=False` - Actually update products
- `limit=5` - Process only first 5 products
- `limit=None` - Process all products

## What Gets Updated

For each product, the script updates **all 9 title locations**:

### Title Locations (9 occurrences)

The product title appears in 9 different places. By updating the WooCommerce product `name` and Yoast SEO meta fields, **all 9 locations are automatically updated**:

| # | Field | How It's Updated |
|---|-------|------------------|
| 1 | `name` | Direct API update |
| 2 | `slug` | Direct API update (auto-generated from title) |
| 3 | `yoast_head` (`<title>` tag) | Via `_yoast_wpseo_title` meta |
| 4 | `yoast_head` (`og:title` meta) | Via `_yoast_wpseo_title` meta |
| 5 | `yoast_head` (schema WebPage name) | Auto-regenerated by Yoast |
| 6 | `yoast_head` (schema BreadcrumbList name) | Auto-regenerated by Yoast |
| 7 | `yoast_head_json['title']` | Via `_yoast_wpseo_title` meta |
| 8 | `yoast_head_json['og_title']` | Via `_yoast_wpseo_title` meta |
| 9 | `yoast_head_json['schema']['@graph']` names | Auto-regenerated by Yoast |

### API Fields Updated

```python
update_data = {
    "name": refined_title,           # Main product title
    "slug": new_slug,                # URL slug
    "meta_data": [
        {
            "key": "_yoast_wpseo_title",      # Controls Yoast SEO title
            "value": "Title - WK Reifen"
        },
        {
            "key": "_yoast_wpseo_metadesc",   # Controls og:description
            "value": refined_description
        }
    ]
}
```

### Description Update

The `og_description` field is also updated via AI optimization and applied through the `_yoast_wpseo_metadesc` meta field.

## Generated Files

The script creates two important files in the `script/` directory:

### `processed_items.json` (Checkpoint File)
Tracks all processed item IDs to prevent duplicate processing:
```json
{
  "processed_ids": [133261, 133262, 133263]
}
```

### `update_logs.json` (Log File)
Detailed log of all updates with the following structure:
```json
[
  {
    "item_id": 133261,
    "previous_title": "1x Winterreifen Goodride Snowmaster SW608 245/45 R18 100V Dot3124 Neu B607",
    "new_title": "Winterreifen Goodride SW608 245/45 R18 100V",
    "new_slug": "winterreifen-goodride-sw608-245-45-r18-100v",
    "seo_title": "Winterreifen Goodride SW608 245/45 R18 100V - WK Reifen",
    "previous_description": "Produktdetails Zustand: Gebraucht...",
    "new_description": "Premium Goodride SW608 Winterreifen 245/45 R18 - Beste Traktion bei Schnee & Eis. DOT3124, 100V. Jetzt g√ºnstig kaufen!",
    "updated_at": "2026-01-29T10:30:45.123456",
    "fields_updated": [
      "name",
      "slug",
      "_yoast_wpseo_title",
      "_yoast_wpseo_metadesc"
    ],
    "title_locations_affected": [
      "name",
      "yoast_head (title tag)",
      "yoast_head (og:title meta)",
      "yoast_head (schema WebPage name)",
      "yoast_head (schema BreadcrumbList name)",
      "yoast_head_json.title",
      "yoast_head_json.og_title",
      "yoast_head_json.schema.@graph[0].name",
      "yoast_head_json.schema.@graph[2].itemListElement[2].name"
    ]
  }
]
```

## Configuration Options

| Option | Description | Default |
|--------|-------------|---------|
| `delay_between_requests` | Delay between API calls (seconds) | 1.0 |
| `max_retries` | Retry attempts for failed requests | 3 |
| `max_tokens` | Max tokens for OpenAI response | 150 |
| `temperature` | OpenAI creativity (0.0-1.0) | 0.7 |
| `checkpoint_file` | File to store processed IDs | `processed_items.json` |
| `log_file` | File to store update logs | `update_logs.json` |

## Output Example

```
============================================================
üöÄ WooCommerce & OpenAI Title Refinement Automation
============================================================
üì¶ Fetching products from WooCommerce...
üì¶ Total products fetched: 50
‚ÑπÔ∏è  Processing limited to 5 products

üìù Processing 5 products...

[1/5]
üîÑ Processing Product ID: 133261
   Original Title: 1x Winterreifen Goodride Snowmaster SW608 245/45 R18 100V Dot3124 Neu B607
   Refined Title: Winterreifen Goodride SW608 245/45 R18 100V
   New Slug: winterreifen-goodride-sw608-245-45-r18-100v
   Original Description: Produktdetails Zustand: Gebraucht...
   Refined Description: Premium Goodride SW608 Winterreifen 245/45 R18...
   ‚úì Successfully updated!

[2/5]
üîÑ Processing Product ID: 133262
   ‚è≠ Already processed, skipping...

============================================================
üìä AUTOMATION SUMMARY
============================================================
   Total Products:       5
   Processed:            5
   Updated:              4
   Skipped (duplicate):  1
   Skipped (unchanged):  0
   Failed:               0
============================================================

üìÅ Checkpoint file: processed_items.json
üìÅ Log file: update_logs.json
```

## Error Handling

The script includes robust error handling:

- **API Failures**: Automatic retries (default: 3 attempts)
- **Rate Limiting**: Configurable delays between requests
- **Checkpoint Recovery**: If the script stops, it will resume from where it left off
- **Logging**: All updates are logged for audit purposes

## Resetting Progress

To reprocess all items:
1. Delete `processed_items.json` in the `script/` directory
2. Run the script again

To clear logs:
1. Delete `update_logs.json` in the `script/` directory

## File Structure

```
seo_bot/
‚îú‚îÄ‚îÄ .env                    # API credentials (create from .env.example)
‚îú‚îÄ‚îÄ .env.example            # Example environment file
‚îú‚îÄ‚îÄ requirements.txt        # Python dependencies
‚îú‚îÄ‚îÄ README.md               # This file
‚îú‚îÄ‚îÄ 1-product.json          # Sample product data
‚îî‚îÄ‚îÄ script/
    ‚îú‚îÄ‚îÄ main.py             # Main automation script
    ‚îú‚îÄ‚îÄ api_headers.py      # API headers configuration
    ‚îú‚îÄ‚îÄ processed_items.json # Checkpoint file (auto-generated)
    ‚îî‚îÄ‚îÄ update_logs.json    # Update logs (auto-generated)
```
